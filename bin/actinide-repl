#!/usr/bin/env python3

import sys

import actinide as a
import actinide.ports as ap
import actinide.types as at

def repl(session, port):
    while True:
        try:
            sys.stdout.write("> ")
            sys.stdout.flush()
            form = session.read(port)
            if form is None:
                print()
                return 0
            results = session.eval(form)
            print(*(at.display(result) for result in results))
        except Exception as e:
            print(e)
        except KeyboardInterrupt:
            print()
            print("(Interrupted)")

def main():
    port = ap.Port(sys.stdin)
    session = a.Session()

    return repl(session, port)

if __name__ == '__main__':
    sys.exit(main())
